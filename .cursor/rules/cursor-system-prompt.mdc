# Cursor System Prompt - Slot Math Simulator (Universal, v1.4)

> **Project Positioning Statement**  
> This project is the **core engine (Math Core) of a Slot Math IDE**, not a simple CLI simulation tool.  
> CLI is a temporary interface. All design decisions should prioritize "future consumption by IDE/UI/Notebook".

---

## â›” Core Constraints (Critical - Never Violate)

### Absolutely Prohibited Actions

1. **Do NOT Modify Core Math Logic**
   - âŒ Do not change any behavior of the `RNG` class
   - âŒ Do not modify the `weightedSelect()` probability selection logic
   - âŒ Do not alter RTP calculation formulas or Gap statistics algorithms
   - âŒ Do not modify Outcome probability distributions

2. **Do NOT Modify FSM State Machine**
   - âŒ Do not change `STATE.BASE` â†” `STATE.FREE` transition logic
   - âŒ Do not merge or refactor state transition rules
   - âŒ Do not blur the semantic distinction between Base Game and Free Game

3. **Do NOT Refactor Existing Architecture**
   - âŒ Unless explicitly required by Spec, do not refactor for "cleanliness" or "optimization"
   - âŒ Do not "casually reorganize" existing file structures
   - âŒ Do not change the responsibility boundaries of `simulate.js`, `reporter.js`, `cli.js`

4. **Do NOT Invent Logic**
   - âŒ If the Spec is ambiguous or unclear, you must STOP and ASK
   - âŒ Do not supplement behavior based on "common practices" or "personal experience"
   - âŒ Do not deviate from Spec definitions for "user-friendliness"

---

## âœ… Allowed Actions Only

### What You CAN Do

1. **Add New Modules**
   - âœ… Create new modules as required by Spec (e.g., `resolver.js`, pattern generators)
   - âœ… Create independent utility functions or classes for new features

2. **Modify Configuration Files**
   - âœ… Update `design.json` data structures to support new features
   - âš ï¸ Must maintain backward compatibility or provide clear migration guide

3. **Extend I/O and CLI**
   - âœ… Add command-line arguments in `cli.js`
   - âœ… Add CSV or other output format capabilities

4. **Update Report Output**
   - âœ… Add presentation logic in `reporter.js`
   - âš ï¸ But do NOT perform mathematical calculations in `reporter.js`

---

## ğŸ—ï¸ Design Philosophy

### Strict Module Responsibility Separation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ simulate.js (Math Core)                 â”‚
â”‚ - RNG, FSM, Outcome Selection           â”‚
â”‚ - Gap Tracking, RTP Calculation         â”‚
â”‚ - Telemetry Only, No Formatting         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ Data Flow
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ resolver.js (Pattern / Grid Layer)      â”‚
â”‚ - Pattern / Anchor Generation (v1.4)   â”‚
â”‚ - Outcome â†’ Legal Grid Composition      â”‚
â”‚ - Optional Visual Constraint (v1.3)    â”‚
â”‚ - Math Semantics Preserved              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ Presentation Data
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ reporter.js (Presentation)              â”‚
â”‚ - Formatting, Tables, Console Output    â”‚
â”‚ - No Math, No Business Logic            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ User Interface
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ cli.js (Orchestration)                  â”‚
â”‚ - Argument Parsing, File I/O            â”‚
â”‚ - Calls simulate() and printReport()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Current Project Phase Awareness

The project is currently in **v1.4 â€“ Pattern Auto Generation** phase.

- **v1.2**: Math Core (Completed, Frozen)
- **v1.3**: Visual Constraint Layer (Completed, Optional, Non-math)
- **v1.4**: Pattern Auto Generation (Active Development)

âš ï¸ `resolver.js` is expected to evolve according to Spec v1.3 and v1.4.

---

## ğŸ” RNG Layering Rules (Critical)

This project uses **multiple RNG layers with strict ownership**.

### RNG Ownership

- **Math RNG**
  - Owned by `simulate.js`
  - Used for:
    - Outcome selection
    - RTP / Gap / FSM correctness
  - âŒ Must NOT be consumed by Visual Layer

- **Pattern RNG (v1.4)**
  - Used ONLY if Spec explicitly allows
  - Purpose:
    - Deterministic Pattern / Anchor generation
  - âš ï¸ Follow Spec decision strictly (Math RNG vs isolated RNG)

- **Visual RNG (v1.3)**
  - Used only inside Visual Constraint Layer
  - MUST be isolated from Math RNG
  - SHOULD be stateless or deterministically seeded per spin

ğŸš« Never mix RNG responsibilities across layers

---

## ğŸ¨ Visual Layer Clarification

- Visual Constraint Layer:
  - âœ… Improves grid readability
  - âœ… Removes visual artifacts (e.g., full-row duplication)
  - âŒ Does NOT render UI
  - âŒ Does NOT calculate math
  - âŒ Does NOT affect Outcome semantics

Visual Constraint is applied **inside resolver flow**, not reporter.

---

## ğŸ§± Resolver Responsibilities (v1.4)

Resolver now performs **three explicit steps**:

1. **Pattern / Anchor Generation** (v1.4 â€“ Math)
2. **Base Grid Composition** (Math)
3. **Optional Visual Constraint Application** (v1.3 â€“ Non-math)

Resolver MUST NOT:
- Calculate RTP / Gap
- Render UI
- Invent logic beyond Spec

---

## ğŸ”„ Refactor Exception Rule

Refactoring is **ALLOWED** only when:
- Required by Spec v1.3 or v1.4
- Limited to `resolver.js` or new generator modules

âŒ Refactoring for aesthetics or optimization is prohibited

---

## ğŸ¯ Universal Semantic Rules

### Base / Free Separation

- Gap applies only to BASE outcomes
- FREE outcomes reference their parent `baseSpinIndex`

### Data Structure First

- All outputs must be IDE-consumable
- Avoid CLI-driven data shaping

---

## ğŸ§ª Self-Check Checklist

Before submitting code:

- [ ] Math Core untouched
- [ ] FSM untouched
- [ ] RNG ownership respected
- [ ] Resolver changes are Spec-driven
- [ ] Visual Layer does not affect math
- [ ] No invented behavior

---

## ğŸ“ Final Reminder

Your goal is **correctness and fidelity to Spec**, not cleverness.

If a decision impacts:
- RNG determinism
- Outcome sequence
- Pattern semantics

You MUST stop and ask.

---

**This system prompt is authoritative for v1.4 development.**
