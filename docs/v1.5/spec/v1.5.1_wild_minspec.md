# v1.5.1 Wild MinSpec（最小規格）

> 目的：讓工程師與 Cursor 以「同一個最小語義」實作 Wild，避免擴張成玩法大雜燴。

---

## 1. 定義

- Wild 是一種 symbol（`type: "WILD"`）。
- v1.5.1 Wild 的唯一能力：**substitute-only**（作為替代符號參與 LINE 連線）。
- Wild **不改變 payout 倍率**、不疊加、不可 sticky / expand。

---

## 2. 範圍（v1.5.1）

- 僅 BASE
- 僅 LINE pay（paylines）
- 單次 spin 最多 0~1 WinEvent（延續 v1.5.0 規則）
- Wild 的替代對象由 config 控制：`wildConfig.substitutableTypes`

---

## 3. 替代規則（核心）

給定：
- `wildSymbolId = "W"`
- `substitutableTypes = ["HIGH","MID","LOW"]`

則：
- 當 targetSymbol 屬於上述 types 時，Wild 可視為 match。
- Wild 不可 match 任何不在 substitutableTypes 的 type（例如 SCATTER/BONUS/FEATURE）。

> 注意：此規則必須由 ruleCtx / predicate 實作，禁止硬編碼在 evaluator loops 裡。

---

## 4. WinEvent 表達（paid vs observed）

當 Wild 參與連線：
- `paidSymbolId` = 實際計價 symbol（例如 H1）
- `positions` 必含 Wild 的座標
- `observedSymbolIds` 對應 grid 原始內容（例如最後一格是 W）

例：`H1-H1-W` 以 H1 計價：
```json
{
  "paidSymbolId": "H1",
  "positions": [[0,0],[0,1],[0,2]],
  "observedSymbolIds": ["H1","H1","W"]
}
```

---

## 5. 不允許（明確排除）

- Wild 觸發任何 feature / state
- Wild 影響 RNG、outcome sequencing
- Wild 影響 visual tease / near-miss
- ANY_POSITION / Multi-win

---

## 5.5 全 Wild 連線規則（Critical）

當連線中**所有符號都是 Wild**（例如 `W-W-W`）：

- **v1.5.1 採用：以 Wild 本身計價（簡化策略）**
  - `paidSymbolId = "W"`
  - `observedSymbolIds = ["W","W","W"]`
- 不實作「以最高價值符號計價」的額外邏輯（延後到後續版本討論）

> 前提：paytable / outcomes 中必須能為 `W` 提供對應的 payout（若你允許 Wild 自己有獎）。

---

## 7. Paytable / Payout 對齊（v1.5.1）

**Truth Source 不變：Outcome 定義 expected payout。**  
Evaluator 的 `winAmount` 必須與 Outcome 的 expected payout 對齊（STRICT_MODE）。

因此在 v1.5.1：
- `paidSymbolId` 只負責「解釋語義」（UI/Debug），不得用來發明 payout。
- 若系統需要由 `paidSymbolId + matchCount` 查表推導 payout，該邏輯必須與 Outcome 的定義一致（否則 STRICT_MODE 會報錯）。

**全 Wild 連線（W-W-W）** 若要成立：
- 必須在 outcomes/paytable 中存在 Wild 的對應定義（或明確定義 Wild 為 0 payout 並由 outcome 避免選到此 win）。

---

## 8. Default Behavior（Robustness）

- 若 `wildConfig` **未定義**：視為「該遊戲沒有 Wild 行為」
  - predicate 應退化為單純的 `cellSymbolId === targetSymbolId`
- 若 grid 中出現 `W` 但 `wildConfig` 未定義：
  - `W` 視為普通符號（只能與 `W` 本身相等）

## 6. Config 範例（最小）

```json
{
  "symbols": [
    {"id":"H1","type":"HIGH"},
    {"id":"L1","type":"LOW"},
    {"id":"W","type":"WILD"}
  ],
  "wildConfig": {
    "wildSymbolId":"W",
    "substitutableTypes":["HIGH","MID","LOW"]
  }
}
```
