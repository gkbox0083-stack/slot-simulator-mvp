# v1.5 Branch A Invariant Spec（系列憲法｜最小集）

> 目的：保護地基。任何 PR 若違反任一條，必須退回修正。

---

## 1. Determinism & Replay

- RNG 結果可重播（相同 seed → 相同 outcome / grid / winEvents）
- 禁止改動 rng.js 或改變 RNG 消耗順序
- outcome selection distribution / tables 不得被改動

---

## 2. Truth Source

- Outcome 定義 expected payout
- Evaluator 只負責 deterministic verifier + explainer
- STRICT_MODE：expectedWin 必須等於 sum(winEvents.winAmount)，不允許靜默修正

---

## 3. Single Evaluation Point

- 每 spin evaluator 僅允許呼叫一次
- simulate.js（或主 pipeline）為唯一 evaluator 入口
- resolver / visual / reporter 禁止呼叫 evaluator

---

## 4. Module Responsibilities

- resolver：Outcome → Grid（不得做 payout）
- evaluator：Grid → WinEvents（不得 mutate grid）
- visual：只能做視覺最佳化（不得影響數學結果）
- reporter：格式化輸出（不得做數學）

---

## 5. v1.5.x Scope Safety

- v1.5.x（含 v1.5.1）不得引入 multi-win（除非版本決策明示開放）
- ANY_POSITION 不得在 v1.5.1 偷渡
